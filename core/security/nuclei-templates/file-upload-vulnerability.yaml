id: file-upload-vulnerability

info:
  name: Unrestricted File Upload Vulnerability
  author: Demon Slayers Training Lab
  severity: high
  description: Detects vulnerable file upload endpoints that accept any file type without validation
  reference:
    - https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload
  tags: file-upload,upload,vulnerability,unrestricted

http:
  - method: POST
    path:
      - "{{BaseURL}}/api/upload"
      - "{{BaseURL}}/upload"
      - "{{BaseURL}}/api/file/upload"

    headers:
      Content-Type: multipart/form-data

    body: |
      ------WebKitFormBoundary7MA4YWxkTrZu0gW
      Content-Disposition: form-data; name="file"; filename="test.php"
      Content-Type: application/x-php

      <?php phpinfo(); ?>
      ------WebKitFormBoundary7MA4YWxkTrZu0gW--

    matchers:
      - type: word
        words:
          - "File uploaded successfully"
          - "uploaded successfully"
          - "File uploaded"
          - "upload"
        condition: or
        part: body

      - type: status
        status:
          - 200
          - 201

    matchers-condition: and

  - method: GET
    path:
      - "{{BaseURL}}/upload"
      - "{{BaseURL}}/file-upload"

    matchers:
      - type: word
        words:
          - "upload"
          - "file"
          - "Choose File"
          - "input type=\"file\""
        condition: or
        part: body

      - type: status
        status:
          - 200

    matchers-condition: and

